
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
      
      
      
        <link rel="prev" href="../about_code_edit/">
      
      
        <link rel="next" href="../zabbix_docker_5and7/">
      
      
      <link rel="icon" href="../assets/images/favicon.png">
      <meta name="generator" content="mkdocs-1.6.1, mkdocs-material-9.6.22">
    
    
      
        <title>ZabbixでAIOSを始めよう - インフラおじさんの日常業務</title>
      
    
    
      <link rel="stylesheet" href="../assets/stylesheets/main.84d31ad4.min.css">
      
      


    
    
      
    
    
      
        
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback">
        <style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style>
      
    
    
    <script>__md_scope=new URL("..",location),__md_hash=e=>[...e].reduce(((e,_)=>(e<<5)-e+_.charCodeAt(0)),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      

    
    
    
  </head>
  
  
    <body dir="ltr">
  
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#zabbixaiops" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
    
      

  

<header class="md-header md-header--shadow" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Header">
    <a href=".." title="インフラおじさんの日常業務" class="md-header__button md-logo" aria-label="インフラおじさんの日常業務" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54"/></svg>

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3zm0 5h18v2H3zm0 5h18v2H3z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            インフラおじさんの日常業務
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              ZabbixでAIOSを始めよう
            
          </span>
        </div>
      </div>
    </div>
    
    
      <script>var palette=__md_get("__palette");if(palette&&palette.color){if("(prefers-color-scheme)"===palette.color.media){var media=matchMedia("(prefers-color-scheme: light)"),input=document.querySelector(media.matches?"[data-md-color-media='(prefers-color-scheme: light)']":"[data-md-color-media='(prefers-color-scheme: dark)']");palette.color.media=input.getAttribute("data-md-color-media"),palette.color.scheme=input.getAttribute("data-md-color-scheme"),palette.color.primary=input.getAttribute("data-md-color-primary"),palette.color.accent=input.getAttribute("data-md-color-accent")}for(var[key,value]of Object.entries(palette.color))document.body.setAttribute("data-md-color-"+key,value)}</script>
    
    
    
      
      
        <label class="md-header__button md-icon" for="__search">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
        </label>
        <div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="Search">
        
        <button type="reset" class="md-search__icon md-icon" title="Clear" aria-label="Clear" tabindex="-1">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"/></svg>
        </button>
      </nav>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" tabindex="0" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list" role="presentation"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
      
    
    
  </nav>
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
          
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    



<nav class="md-nav md-nav--primary" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href=".." title="インフラおじさんの日常業務" class="md-nav__button md-logo" aria-label="インフラおじさんの日常業務" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54"/></svg>

    </a>
    インフラおじさんの日常業務
  </label>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href=".." class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Home
    
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../tags/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Tags
    
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../hello-world/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    自己紹介
    
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../about_code_edit/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    エディタの話
    
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
    
  
  
  
    <li class="md-nav__item md-nav__item--active">
      
      <input class="md-nav__toggle md-toggle" type="checkbox" id="__toc">
      
      
        
      
      
        <label class="md-nav__link md-nav__link--active" for="__toc">
          
  
  
  <span class="md-ellipsis">
    ZabbixでAIOSを始めよう
    
  </span>
  

          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <a href="./" class="md-nav__link md-nav__link--active">
        
  
  
  <span class="md-ellipsis">
    ZabbixでAIOSを始めよう
    
  </span>
  

      </a>
      
        

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#_1" class="md-nav__link">
    <span class="md-ellipsis">
      仕組みの概要
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#_2" class="md-nav__link">
    <span class="md-ellipsis">
      出力例
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#_3" class="md-nav__link">
    <span class="md-ellipsis">
      メリット（運用担当者視点）
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#_4" class="md-nav__link">
    <span class="md-ellipsis">
      まとめ
    </span>
  </a>
  
</li>
      
    </ul>
  
</nav>
      
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../zabbix_docker_5and7/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Dockerで新旧バージョンのZabbixをサクッと動かそう
    
  </span>
  

      </a>
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#_1" class="md-nav__link">
    <span class="md-ellipsis">
      仕組みの概要
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#_2" class="md-nav__link">
    <span class="md-ellipsis">
      出力例
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#_3" class="md-nav__link">
    <span class="md-ellipsis">
      メリット（運用担当者視点）
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#_4" class="md-nav__link">
    <span class="md-ellipsis">
      まとめ
    </span>
  </a>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          
            <div class="md-content" data-md-component="content">
              <article class="md-content__inner md-typeset">
                
                  



<h1 id="zabbixaiops">Zabbixで始めるAIOPS<a class="headerlink" href="#zabbixaiops" title="Permanent link">&para;</a></h1>
<p>Zabbixは強力なオープンソース監視ソリューションですが、実際の運用現場では「検知した障害にどう対応するか」という部分で、運用者の経験やナレッジに頼るケースが多いと思います。
そこで今回は、<a href="https://blog.zabbix.com/creating-a-personal-assistant-in-zabbix-with-artificial-intelligence/29596/">Zabbix公式ブログの記事</a> を参考にしながら、Zabbixの「スクリプト」機能とGoogle Gemini APIを組み合わせ、<strong>障害の原因や対応方法を自動で提案してくれる“運用アシスタント”</strong> を作ってみました。おそらくGemini以外でも動作します。</p>
<p>最近注目されている <strong>AIOps（Artificial Intelligence for IT Operations）</strong> の入り口となる取り組みといえるかも。</p>
<hr />
<h2 id="_1">仕組みの概要<a class="headerlink" href="#_1" title="Permanent link">&para;</a></h2>
<ul>
<li><strong>使ったZabbixのマクロ</strong></li>
<li><code>{EVENT.SEVERITY}</code>（障害の深刻度）</li>
<li><code>{TRIGGER.NAME}</code>（障害内容）</li>
<li><code>{HOST.DESCRIPTION}</code>（ホストの説明）</li>
<li><code>{HOST.HOST}</code>（ホスト名）</li>
<li>マクロ以外にGemini(等)のAPIKeyも必要です</li>
</ul>
<p><img alt="設定画面のスクリーンショット" src="../assets/sc02.png" /></p>
<ul>
<li><strong>Zabbixのスクリプトに記述したコード</strong></li>
</ul>
<pre><code class="language-script">var Gemini = {
    params: {},
    setParams: function(params) {
        if (typeof params !== 'object') {
            return;
        }
        Gemini.params = params;
        if (typeof Gemini.params.api_key !== 'string' || Gemini.params.api_key === '') {
            throw 'API key for Gemini is required.';
        }
        Gemini.params.url = 'https://generativelanguage.googleapis.com/v1beta/models/gemini-2.5-flash:generateContent';
    },
    request: function(data) {
        if (!Gemini.params.api_key) {
            throw 'API key is missing.';
        }
        var request = new HttpRequest();
        request.addHeader('Content-Type: application/json');

        // Construir URL con API key
        var urlWithKey = Gemini.params.url + '?key=' + Gemini.params.api_key;

        Zabbix.log(4, '[ Gemini Webhook ] Sending request: ' + urlWithKey + '\n' + JSON.stringify(data));
        var response = request.post(urlWithKey, JSON.stringify(data));
        Zabbix.log(4, '[ Gemini Webhook ] Received response with status code ' + request.getStatus() + '\n' + response);

        if (request.getStatus() &lt; 200 || request.getStatus() &gt;= 300) {
            throw 'Gemini API request failed with status code ' + request.getStatus() + '.';
        }

        try {
            response = JSON.parse(response);
        } catch (error) {
            Zabbix.log(4, '[ Gemini Webhook ] Failed to parse response from Gemini.');
            response = null;
        }
        return response;
    }
};

try {
    var params = JSON.parse(value),
        data = {},
        result = &quot;&quot;,
        required_params = ['alert_subject'];
    var params = JSON.parse(value),
        data = {},
        result = &quot;&quot;,
        required_params = ['host_name'];
    var params = JSON.parse(value),
        data = {},
        result = &quot;&quot;,
        required_params = ['host_description'];        
    var params = JSON.parse(value),
        data = {},
        result = &quot;&quot;,
        required_params = ['alet_severity'];        


    Object.keys(params).forEach(function(key) {
        if (required_params.indexOf(key) !== -1 &amp;&amp; params[key] === '') {
            throw 'Parameter &quot;' + key + '&quot; cannot be empty.';
        }
    });

    // Formatear la consulta para Gemini
    data = {
        contents: [{
            parts: [{
                text: &quot;Zabbixが深刻度: &quot; + params.alert_severity + &quot;の障害: &quot; + params.alert_subject + &quot;を、ホスト：&quot; + params.host_name + &quot;で検知しました。 &quot; +
                      &quot;このホストの概要は: &quot; + params.host_description + &quot;です。 &quot; +
                      &quot;この障害を解決するために、考えられる原因と解決策を提案してください。箇条書きで出力してください。 &quot; +
                      &quot;20行程度で、障害原因、調査ポイント 対応コマンド、作業時のリスク、将来のインシデントを軽減するための対策などを記載してください。&quot;
            }]
        }]
    };

    // Configurar la API de Gemini
    Gemini.setParams({ api_key: params.api_key });

    // Hacer la solicitud a Gemini
    var response = Gemini.request(data);

    if (response &amp;&amp; response.candidates &amp;&amp; response.candidates.length &gt; 0) {
        result = response.candidates[0].content.parts[0].text.trim();
    } else {
        throw 'No response from Gemini.';
    }

    return result;

} catch (error) {
    Zabbix.log(3, '[ Gemini Webhook ] ERROR: ' + error);
    throw 'Sending failed: ' + error;
}
</code></pre>
<ul>
<li>
<p><strong>動作イメージ</strong></p>
</li>
<li>
<p>Zabbixが障害を検知</p>
</li>
<li>上記の情報をスクリプト経由でGemini APIに渡す</li>
<li>AIが「障害原因・調査ポイント・対応コマンド・リスク・将来の予防策」をまとめて返す</li>
<li>結果がZabbix上の通知に表示される</li>
</ul>
<hr />
<h2 id="_2">出力例<a class="headerlink" href="#_2" title="Permanent link">&para;</a></h2>
<p>たとえば「ICMP Pingが失敗した」という障害では、AIから以下のような提案が返ってきます。</p>
<ul>
<li>ネットワーク断、ルータ障害の可能性</li>
<li>ICMP応答がOSレベルで無効化されている可能性</li>
<li>疎通確認コマンド: <code>ping</code> / <code>traceroute</code></li>
<li>リスク: 調査時に本番トラフィックへ影響が出る可能性あり</li>
<li>予防策: 冗長化やサービスレベル監視の導入</li>
</ul>
<p>従来であれば運用担当者がマニュアルや過去ナレッジを参照して判断していた部分を、<strong>AIが即時に候補を提示してくれる</strong>のが大きなポイントです。</p>
<p><img alt="結果表示のスクリーンショット" src="../assets/sc03.png" /></p>
<hr />
<h2 id="_3">メリット（運用担当者視点）<a class="headerlink" href="#_3" title="Permanent link">&para;</a></h2>
<ul>
<li>初動対応のスピードが上がる</li>
<li>経験の浅いメンバーでも調査を進めやすい</li>
<li>チーム内のナレッジ不足を補える</li>
<li>将来的にはナレッジベース化して“学習する運用”に発展可能</li>
</ul>
<hr />
<h2 id="_4">まとめ<a class="headerlink" href="#_4" title="Permanent link">&para;</a></h2>
<p>今回の仕組みはシンプルですが、<strong>「監視データ＋AI」＝ AIOpsの第一歩</strong> としてとても有効です。
Zabbixユーザーであれば、スクリプトにGemini APIキーを設定するだけで再現可能なので、ぜひ試してみてください。</p>
<p>運用の現場にAIを取り入れることで、単なる監視ツールから「運用支援ツール」へと進化させることができます。</p>
<hr />
<p>次のステップとしては、AIの提案を <strong>Zabbixのアクションメッセージ</strong> に組み込んだり、<strong>チケットシステム連携</strong>に拡張すれば、さらに実運用での効果が高まると思います。
他にも <strong>「イベント一覧をExcelに取り込んでそれぞれの対応内容をLLMに埋めてもらう」</strong> とか <strong>「一定期間のメトリックを取得してpythonにグラフを描いてもらってメトリックとグラフをLLMに送ってレポートを描いてもらう」</strong> とか運用の定常業務を自動化したノウハウもありますのでおいおい公開していきます。
最後にもう１つ、これらを <strong>オンプレミスで完結させることが可能です</strong> オンプレミスだからって諦める必要はないんです。 <strong>オンプレミスでもAIOPS</strong> やっていきましょう！</p>
<hr />












                
              </article>
            </div>
          
          
<script>var target=document.getElementById(location.hash.slice(1));target&&target.name&&(target.checked=target.name.startsWith("__tabbed_"))</script>
        </div>
        
      </main>
      
        <footer class="md-footer">
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
  
    Made with
    <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
      Material for MkDocs
    </a>
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    
    
    
      
      <script id="__config" type="application/json">{"base": "..", "features": [], "search": "../assets/javascripts/workers/search.973d3a69.min.js", "tags": null, "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version": "Select version"}, "version": null}</script>
    
    
      <script src="../assets/javascripts/bundle.f55a23d4.min.js"></script>
      
    
  </body>
</html>